<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Corporate Mail Outlook Style</title>
<style>
    /* --- 1. –ë–ê–ó–ê --- */
    body, html { margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', Roboto, Arial, sans-serif; background: #f3f2f1; overflow: hidden; }
    
    /* --- 2. –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù --- */
    #start-screen {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: #f3f2f1; z-index: 9999;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        padding: 20px; box-sizing: border-box;
    }
    .intro-card {
        background: white; padding: 40px; border-radius: 8px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 500px; text-align: center;
    }
    .intro-title { color: #0078d4; font-size: 24px; margin-bottom: 10px; font-weight: 700; }
    .intro-text { color: #333; font-size: 15px; line-height: 1.6; margin-bottom: 30px; text-align: left; }
    .start-btn {
        background: #0078d4; color: white; border: none; padding: 12px 30px;
        font-size: 16px; border-radius: 4px; cursor: pointer; font-weight: 600;
        transition: 0.2s;
    }
    .start-btn:hover { background: #005a9e; }

    /* --- 3. –ò–ù–¢–ï–†–§–ï–ô–° –ü–û–ß–¢–´ --- */
    .app { display: flex; flex-direction: column; height: 100%; background: white; }
    
    .top-bar {
        height: 48px; background: #0078d4; color: white;
        display: flex; align-items: center; padding: 0 20px; flex-shrink: 0;
        justify-content: space-between;
    }
    .logo { font-weight: bold; font-size: 18px; display: flex; gap: 10px; align-items: center; }

    .main-area { display: flex; flex: 1; overflow: hidden; }

    /* –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê */
    .inbox-list {
        width: 320px; background: #fff; border-right: 1px solid #e1dfdd;
        display: flex; flex-direction: column; flex-shrink: 0;
        overflow-y: auto;
    }
    .inbox-header {
        padding: 15px; border-bottom: 1px solid #e1dfdd; font-weight: 600;
        color: #333; display: flex; justify-content: space-between;
    }
    
    .email-item {
        padding: 15px; border-bottom: 1px solid #f3f2f1; cursor: pointer;
        transition: 0.1s; position: relative;
    }
    .email-item:hover { background: #f3f2f1; }
    .email-item.active { background: #c7e0f4; border-left: 4px solid #0078d4; }
    .email-item.unread .item-subject, .email-item.unread .item-from { font-weight: 700; color: #000; }
    .email-item.done { border-left: 4px solid #107c10; opacity: 0.6; background: #fdfdfd; }
    
    .item-from { font-size: 14px; color: #201f1e; margin-bottom: 4px; display: flex; justify-content: space-between;}
    .item-subject { font-size: 13px; color: #0078d4; margin-bottom: 4px; }
    .item-preview { font-size: 12px; color: #605e5c; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
    
    /* –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê */
    .reading-pane { flex: 1; background: #faf9f8; display: flex; flex-direction: column; overflow: hidden; position: relative; }
    
    .empty-state {
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        height: 100%; color: #605e5c;
    }
    .empty-icon { font-size: 60px; margin-bottom: 20px; opacity: 0.3; }

    /* –ü–µ—Ä–µ–ø–∏—Å–∫–∞ */
    .thread-view { flex: 1; overflow-y: auto; padding: 20px 40px; display: none; }
    .thread-view.show { display: block; }

    .mail-card {
        background: white; border: 1px solid #e1dfdd; padding: 25px;
        margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        animation: fadeIn 0.3s ease;
    }
    .mail-header { display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid #f3f2f1; padding-bottom: 10px; }
    .mail-avatar { 
        width: 42px; height: 42px; border-radius: 50%; color: white; 
        display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 12px; 
    }
    .av-alex { background: #d83b01; }
    .av-katya { background: #d13438; }
    .av-me { background: #0078d4; }
    .av-sys { background: #333; }

    .mail-body { font-size: 15px; line-height: 1.6; color: #323130; white-space: pre-wrap; }

    /* –ü–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ */
    .action-panel { margin-top: 20px; border-top: 2px solid #0078d4; padding-top: 20px; background: #fff; padding: 20px; }
    .action-title { font-size: 12px; font-weight: bold; color: #666; text-transform: uppercase; margin-bottom: 10px; }
    
    .choice-btn {
        display: block; width: 100%; text-align: left;
        background: white; border: 1px solid #8a8886; border-radius: 4px;
        padding: 12px 15px; margin-bottom: 8px; cursor: pointer;
        font-size: 14px; transition: 0.1s;
    }
    .choice-btn:hover { background: #eff6fc; border-color: #0078d4; }
    .choice-btn strong { display: block; color: #000; margin-bottom: 3px; }

    /* –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è */
    .sys-msg { padding: 15px; text-align: center; font-size: 14px; border-radius: 4px; margin-bottom: 20px; }
    .sys-good { background: #dff6dd; color: #107c10; border: 1px solid #107c10; }
    .sys-bad { background: #fde7e9; color: #a80000; border: 1px solid #a80000; }

    /* –ê–¥–∞–ø—Ç–∏–≤ */
    @media (max-width: 700px) {
        .inbox-list { width: 100%; display: flex; }
        .reading-pane { display: none; width: 100%; }
        .reading-pane.active { display: flex; }
        .inbox-list.hidden { display: none; }
        .back-btn { display: inline-block; }
    }
    .back-btn { display: none; color: white; background: none; border: none; font-size: 20px; cursor: pointer; margin-right: 10px; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .typing { font-size: 12px; color: #0078d4; margin-left: 20px; display: none; font-style: italic; padding-bottom: 20px;}
</style>
</head>
<body>

<!-- 1. –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù -->
<div id="start-screen">
    <div class="intro-card">
        <div style="font-size: 50px; margin-bottom: 20px;">üìß</div>
        <h1 class="intro-title">–í—Ö–æ–¥—è—â–∞—è –ø–æ—á—Ç–∞</h1>
        <div class="intro-text">
            <p><b>–í–∞—à–∞ —Ä–æ–ª—å:</b> –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –æ—Ç–¥–µ–ª–∞.</p>
            <p><b>–°–∏—Ç—É–∞—Ü–∏—è:</b> –í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å —Å –æ–±–µ–¥–∞ –∏ –≤–∏–¥–∏—Ç–µ –¥–≤–∞ –Ω–æ–≤—ã—Ö –ø–∏—Å—å–º–∞. –û–±–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è.</p>
            <p>1. <b>–ê–ª–µ–∫—Å–µ–π</b> (–í–µ–¥—É—â–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫) –ø—Ä–∏—Å–ª–∞–ª –æ—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à—É –∑–∞–¥–∞—á—É –ø–æ –æ—Ç—á–µ—Ç—É.<br>
            2. <b>–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞</b> (–ù–æ–≤–∏—á–æ–∫ –≤ –ø—Ä–æ–¥–∞–∂–∞—Ö) –≥–æ—Ä–∏—Ç –Ω–æ–≤–æ–π –∏–¥–µ–µ–π.</p>
            <p><b>–ó–∞–¥–∞—á–∞:</b> –†–∞–∑–±–µ—Ä–∏—Ç–µ –ø–æ—á—Ç—É, –≤—ã–±—Ä–∞–≤ –≤–µ—Ä–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é. –í–∞—à–∏ –æ—Ç–≤–µ—Ç—ã –∏–º–µ—é—Ç –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è.</p>
        </div>
        <button class="start-btn" onclick="startGame()">–û—Ç–∫—Ä—ã—Ç—å –ø–æ—á—Ç—É</button>
    </div>
</div>

<!-- 2. –ò–ù–¢–ï–†–§–ï–ô–° -->
<div class="app">
    <div class="top-bar">
        <div class="logo">
            <button class="back-btn" onclick="showInbox()">‚Üê</button>
            Outlook Web
        </div>
        <div>–í—Ö–æ–¥—è—â–∏–µ: <span id="unread-counter" style="background:white; color:#0078d4; padding:2px 6px; border-radius:10px; font-size:12px;">2</span></div>
    </div>

    <div class="main-area">
        <!-- –°–ü–ò–°–û–ö –ü–ò–°–ï–ú -->
        <div class="inbox-list" id="inbox">
            <div class="inbox-header">–í—Ö–æ–¥—è—â–∏–µ</div>
            <!-- –ü–∏—Å—å–º–æ 1: –ê–ª–µ–∫—Å–µ–π -->
            <div class="email-item unread" id="item-alex" onclick="openMail('alex')">
                <div class="item-from">
                    <span>–ê–ª–µ–∫—Å–µ–π –°–º–∏—Ä–Ω–æ–≤</span>
                    <span style="font-size:11px; color:#0078d4;">13:45</span>
                </div>
                <div class="item-subject">RE: –ì–æ–¥–æ–≤–æ–π –æ—Ç—á–µ—Ç</div>
                <div class="item-preview">–°–ª—É—à–∞–π—Ç–µ, —É –º–µ–Ω—è –∑–∞–≤–∞–ª...</div>
            </div>
            <!-- –ü–∏—Å—å–º–æ 2: –ö–∞—Ç—è -->
            <div class="email-item unread" id="item-katya" onclick="openMail('katya')">
                <div class="item-from">
                    <span>–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –ù–æ–≤–∏–∫–æ–≤–∞</span>
                    <span style="font-size:11px; color:#0078d4;">14:10</span>
                </div>
                <div class="item-subject">–ò–¥–µ—è –ø–æ –∫–ª–∏–µ–Ω—Ç—É "–ê–ª—å—Ñ–∞"!</div>
                <div class="item-preview">–Ø –Ω–∞—à–ª–∞ –∫–æ–Ω—Ç–∞–∫—Ç –õ–ü–†!</div>
            </div>
        </div>

        <!-- –û–ë–õ–ê–°–¢–¨ –ß–¢–ï–ù–ò–Ø -->
        <div class="reading-pane" id="reading-pane">
            <div class="empty-state" id="empty-state">
                <div class="empty-icon">üìß</div>
                <div>–í—ã–±–µ—Ä–∏—Ç–µ –ø–∏—Å—å–º–æ –¥–ª—è —á—Ç–µ–Ω–∏—è</div>
            </div>
            
            <!-- –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ü–ï–†–ï–ü–ò–°–ö–ò -->
            <div class="thread-view" id="thread-content"></div>
            <div class="typing" id="typing-indicator">–ü–∏—à–µ—Ç –æ—Ç–≤–µ—Ç...</div>
            <div id="action-area"></div>
        </div>
    </div>
</div>

<script>
    // --- –î–ê–ù–ù–´–ï (STATE) ---
    let state = {
        alex: { status: 'new', history: [], currentOptions: null },
        katya: { status: 'new', history: [], currentOptions: null },
        unread: 2
    };

    // –°–¶–ï–ù–ê–†–ò–ò
    const scenarios = {
        // --- –ê–õ–ï–ö–°–ï–ô ---
        'alex': {
            'start': {
                // –ü–µ—Ä–≤—ã–π —à–∞–≥ - —ç—Ç–æ –≤–∞—à–µ –∏—Å—Ö–æ–¥—è—â–µ–µ –∏ –µ–≥–æ –≤—Ö–æ–¥—è—â–µ–µ
                emails: [
                    {
                        from: 'me',
                        time: '13:30',
                        body: '–ê–ª–µ–∫—Å–µ–π, –ø—Ä–∏–≤–µ—Ç.\n\n–ù–∞–º –Ω—É–∂–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º –∫ —ç—Ç–æ–π –ø—è—Ç–Ω–∏—Ü–µ. –í–≤–æ–¥–Ω—ã–µ –≤–æ –≤–ª–æ–∂–µ–Ω–∏–∏. –ñ–¥—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.'
                    },
                    {
                        from: 'alex',
                        time: '13:45',
                        delay: 1000,
                        body: '–î–æ–±—Ä—ã–π –¥–µ–Ω—å.\n\n–°–ª—É—à–∞–π—Ç–µ, —É –º–µ–Ω—è —Å–µ–π—á–∞—Å –ø–æ–ª–Ω—ã–π –∑–∞–≤–∞–ª –ø–æ —Ç–µ–∫—É—â–∏–º –ø—Ä–æ–µ–∫—Ç–∞–º. –ú—ã –∂–µ –ø–æ–º–Ω–∏–º –ø—Ä–æ—à–ª—ã–π –≥–æ–¥? –Ø –ø–æ—Ç—Ä–∞—Ç–∏–ª –Ω–∞ —ç—Ç–æ—Ç –æ—Ç—á–µ—Ç –≤—ã—Ö–æ–¥–Ω—ã–µ, –∞ –µ–≥–æ –¥–∞–∂–µ –Ω–µ –æ—Ç–∫—Ä—ã–ª–∏ –Ω–∞ —Å–æ–≤–µ—Ç–µ.\n\n–ú–æ–∂–µ—Ç, –ø–æ—Ä—É—á–∏–º —ç—Ç–æ —Å—Ç–∞–∂–µ—Ä—É? –Ø –ø—Ä–∞–≤–¥–∞ –Ω–µ –≤–∏–∂—É —Å–º—ã—Å–ª–∞ —Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ —ç—Ç–æ —Ä–µ—Å—É—Ä—Å –æ–ø—ã—Ç–Ω–æ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.'
                    }
                ],
                options: [
                    { title: '–ù–∞–¥–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–æ–º', desc: '¬´–ï—Å—Ç—å –∑–∞–¥–∞—á–∞ ‚Äî –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å. –≠—Ç–æ —Ç–≤–æ—è –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—å¬ª.', next: 'pressure' },
                    { title: '–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–æ–º–ø—Ä–æ–º–∏—Å—Å', desc: '¬´–°–¥–µ–ª–∞–π, –∞ —è –¥–∞–º —Ç–µ–±–µ –æ—Ç–≥—É–ª –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫¬ª.', next: 'bargain' },
                    { title: '–í—ã—è—Å–Ω–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É', desc: '¬´–¢—ã –≥–æ–≤–æ—Ä–∏—à—å, —á—Ç–æ –Ω–µ –≤–∏–¥–∏—à—å —Å–º—ã—Å–ª–∞. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –¥–µ–º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç?¬ª', next: 'dialog' }
                ]
            },
            'pressure': {
                my_reply: '–ê–ª–µ–∫—Å–µ–π, –¥–∞–≤–∞–π –±–µ–∑ –¥–∏—Å–∫—É—Å—Å–∏–π. –≠—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ —Ç–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏ KPI. –°—Ç–∞–∂–µ—Ä –Ω–µ —Å–ø—Ä–∞–≤–∏—Ç—Å—è —Å —Ç–∞–∫–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π. –ñ–¥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ø—è—Ç–Ω–∏—Ü—É.',
                emails: [
                    { from: 'alex', body: '–ü—Ä–∏–Ω—è—Ç–æ. –ë—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ.' },
                    { type: 'sys_bad', body: '‚õî –†–ò–°–ö: –ê–ª–µ–∫—Å–µ–π –¥–µ–ª–∞–µ—Ç –æ—Ç—á–µ—Ç —Ñ–æ—Ä–º–∞–ª—å–Ω–æ, "–¥–ª—è –≥–∞–ª–æ—á–∫–∏". –í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Ö–æ–ª–æ–¥ –≤ –æ–±—â–µ–Ω–∏–∏. –í—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏ –¥–∞–≤–ª–µ–Ω–∏–µ –∫ —ç–∫—Å–ø–µ—Ä—Ç—É, –∏ –æ–Ω –∑–∞–∫—Ä—ã–ª—Å—è.' }
                ],
                options: [
                    { title: '–ü—Ä–∏–∑–Ω–∞—Ç—å –æ—à–∏–±–∫—É –∏ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å', desc: '–ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é (–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –¥–∏–∞–ª–æ–≥—É)', next: 'dialog' },
                    { title: '–û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å', desc: '–ì–ª–∞–≤–Ω–æ–µ - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—É—á–µ–Ω.', next: 'fail_pressure' }
                ]
            },
            'fail_pressure': {
                emails: [{ type: 'sys_bad', body: '‚ùå –ò–¢–û–ì: –í—ã –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç—á–µ—Ç, –Ω–æ –ø–æ—Ç–µ—Ä—è–ª–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–∞. –ß–µ—Ä–µ–∑ –º–µ—Å—è—Ü –æ–Ω –Ω–∞—á–Ω–µ—Ç –∏—Å–∫–∞—Ç—å –Ω–æ–≤—É—é —Ä–∞–±–æ—Ç—É.' }],
                end: true
            },
            'bargain': {
                my_reply: '–õ–µ—à, –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –∑–∞–¥–∞—á–∞ –Ω—É–¥–Ω–∞—è. –î–∞–≤–∞–π —Ç–∞–∫: —Ç—ã –¥–µ–ª–∞–µ—à—å –æ—Ç—á–µ—Ç –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ, –∞ —è —Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞—é —Ç–µ–±–µ –æ—Ç–≥—É–ª.',
                emails: [{ from: 'alex', body: '–î–µ–ª–æ –Ω–µ –≤ –æ—Ç–≥—É–ª–µ... –ù–æ –ª–∞–¥–Ω–æ, –æ—Ç–¥–æ—Ö–Ω—É—Ç—å –Ω–µ –ø–æ–º–µ—à–∞–µ—Ç. –°–¥–µ–ª–∞—é.' }, { type: 'sys_bad', body: '‚ö†Ô∏è –ò–¢–û–ì: –í—ã —Å–æ–∑–¥–∞–ª–∏ –æ–ø–∞—Å–Ω—ã–π –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç. –¢–µ–ø–µ—Ä—å –æ–Ω –±—É–¥–µ—Ç —Ç–æ—Ä–≥–æ–≤–∞—Ç—å—Å—è –∑–∞ –∫–∞–∂–¥—É—é —Å–ª–æ–∂–Ω—É—é –∑–∞–¥–∞—á—É.' }],
                end: true
            },
            'dialog': {
                my_reply: '–¢—ã –≥–æ–≤–æ—Ä–∏—à—å, —á—Ç–æ –Ω–µ –≤–∏–¥–∏—à—å —Å–º—ã—Å–ª–∞. –≠—Ç–æ –∑–≤—É—á–∏—Ç –∫–∞–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–±–∏–¥–∞. –î–∞–≤–∞–π —á–µ—Å—Ç–Ω–æ: –≤ —á–µ–º –ø—Ä–∏—á–∏–Ω–∞?',
                emails: [{ from: 'alex', body: '–î–∞ –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞ ¬´–≤ —Å—Ç–æ–ª¬ª! –Ø –≤ –ø—Ä–æ—à–ª–æ–º –≥–æ–¥—É –Ω–∞—à–µ–ª –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∏—Å—Ç–∏–∫–µ, –∞ –§–∏–Ω–¥–∏—Ä –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—à–∏–ª –ø–∞–ø–∫—É. –ù–∏–∫—Ç–æ –¥–∞–∂–µ —Å–ø–∞—Å–∏–±–æ –Ω–µ —Å–∫–∞–∑–∞–ª.' }],
                options: [
                    { title: '–î–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ', desc: '¬´–¢—ã –ø—Ä–æ—Ñ–∏, —Å–¥–µ–ª–∞–π —Ç–∞–∫, —á—Ç–æ–±—ã –∑–∞–º–µ—Ç–∏–ª–∏¬ª.', next: 'delegate_fail' },
                    { title: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –ø—Ä–æ–¥–∞–∂–∞', desc: '¬´–Ø –ª–∏—á–Ω–æ –ø—Ä–µ–∑–µ–Ω—Ç—É—é —Ç–≤–æ–π –≤–∫–ª–∞–¥ –Ω–∞ —Å–æ–≤–µ—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤¬ª.', next: 'win' }
                ]
            },
            'delegate_fail': {
                my_reply: '–õ–µ—à, —Ç—ã –∂–µ –ø—Ä–æ—Ñ–∏. –°–∞–º –∑–Ω–∞–µ—à—å, –∫–∞–∫ –ø–æ–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.',
                emails: [{ from: 'alex', body: '–Ø —É–∂–µ –ø—Ä–æ–±–æ–≤–∞–ª. –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –õ–∞–¥–Ω–æ, —Å–¥–µ–ª–∞—é –∫–∞–∫ –æ–±—ã—á–Ω–æ.' }, { type: 'sys_bad', body: '‚ö†Ô∏è –û–®–ò–ë–ö–ê: –í—ã –ø–æ–ø—ã—Ç–∞–ª–∏—Å—å –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É –¥–µ–º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É. –û–Ω –Ω–µ –ø—Ä–æ—è–≤–∏—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É.' }],
                end: true
            },
            'win': {
                my_reply: '–Ø –Ω–µ –∑–Ω–∞–ª –ø—Ä–æ —Ç–æ—Ç –∫–µ–π—Å. –í —ç—Ç–æ–º –≥–æ–¥—É –º—ã –∑–∞—â–∏—â–∞–µ–º –±—é–¥–∂–µ—Ç. –Ø –ª–∏—á–Ω–æ –ø—Ä–µ–∑–µ–Ω—Ç—É—é —Ç–≤–æ–π —Å–ª–∞–π–¥ —Å –≤—ã–≤–æ–¥–∞–º–∏ –Ω–∞ —Å–æ–≤–µ—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤. –¢–≤–æ—è —Ä–∞–±–æ—Ç–∞ –±—É–¥–µ—Ç –≤–∏–¥–Ω–∞.',
                emails: [{ from: 'alex', body: '–ï—Å–ª–∏ –ª–∏—á–Ω–æ –Ω–∞ —Å–æ–≤–µ—Ç–µ... —Ç–æ–≥–¥–∞ –ª–∞–¥–Ω–æ. –£ –º–µ–Ω—è –µ—Å—Ç—å –∏–¥–µ—è, –∫–∞–∫ –ø–æ–∫–∞–∑–∞—Ç—å –¥–∏–Ω–∞–º–∏–∫—É –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ.' }, { type: 'sys_good', body: '‚úÖ –ü–û–ë–ï–î–ê! –í—ã –≤–µ—Ä–Ω—É–ª–∏ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –ø–æ–∫–∞–∑–∞–≤ –∑–Ω–∞—á–∏–º–æ—Å—Ç—å –µ–≥–æ —Ä–∞–±–æ—Ç—ã (–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π —Å—Ç–∏–ª—å).' }],
                success: true,
                end: true
            }
        },

        // --- –ö–ê–¢–Ø ---
        'katya': {
            'start': {
                emails: [
                    {
                        from: 'katya',
                        time: '14:10',
                        body: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á! –Ø —É–≤–∏–¥–µ–ª–∞ –≤ –±–∞–∑–µ, —á—Ç–æ –º—ã –ø—ã—Ç–∞–µ–º—Å—è –≤—ã–π—Ç–∏ –Ω–∞ —Ö–æ–ª–¥–∏–Ω–≥ "–ê–ª—å—Ñ–∞". –Ø –Ω–∞—à–ª–∞ –º–æ–±–∏–ª—å–Ω—ã–π –∏—Ö –õ–ü–†! –£ –º–µ–Ω—è –µ—Å—Ç—å —Å—É–ø–µ—Ä-–∏–¥–µ—è, –∫–∞–∫ –∑–∞–π—Ç–∏ —á–µ—Ä–µ–∑ –∫—Ä–µ–∞—Ç–∏–≤. –ú–æ–∂–Ω–æ —è –µ–º—É –Ω–∞–±–µ—Ä—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å? –Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –¥–æ–∂–º—É!'
                    }
                ],
                options: [
                    { title: '–†–∞–∑—Ä–µ—à–∏—Ç—å (–î–æ–≤–µ—Ä–∏–µ)', desc: '¬´–£ —Ç–µ–±—è –≥–ª–∞–∑–∞ –≥–æ—Ä—è—Ç, –¥–µ–π—Å—Ç–≤—É–π! –Ø –¥–æ–≤–µ—Ä—è—é¬ª.', next: 'risk' },
                    { title: '–ó–∞–ø—Ä–µ—Ç–∏—Ç—å (–û—Ö–ª–∞–¥–∏—Ç—å)', desc: '¬´–†–∞–Ω–æ —Ç–µ–±–µ –µ—â–µ. –ò–¥–∏ —É—á–∏ —Å–∫—Ä–∏–ø—Ç—ã¬ª.', next: 'demotivation' },
                    { title: '–ù–∞–ø—Ä–∞–≤–∏—Ç—å (–°—Ç—Ä—É–∫—Ç—É—Ä–∞)', desc: '¬´–≠–Ω–µ—Ä–≥–∏—è —Å—É–ø–µ—Ä, –Ω–æ –∫–ª–∏–µ–Ω—Ç —Å–ª–æ–∂–Ω—ã–π. –î–∞–≤–∞–π —Å–Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—à–µ–º –ø–ª–∞–Ω¬ª.', next: 'win' }
                ]
            },
            'risk': {
                my_reply: '–û–∫–µ–π, –ö–∞—Ç—è, –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Ç–≤–æ–π –Ω–∞–ø–æ—Ä. –ó–≤–æ–Ω–∏, –≤–µ—Ä—é –≤ —Ç–µ–±—è.',
                emails: [
                    { from: 'katya', delay: 2000, body: '...(–°–ø—É—Å—Ç—è —á–∞—Å)...\n\n–û–Ω... –æ–Ω –±—Ä–æ—Å–∏–ª —Ç—Ä—É–±–∫—É. –°–∫–∞–∑–∞–ª, —á—Ç–æ –º—ã –Ω–µ–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—ã. –Ø –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ç–µ–ª–∞ –ø–æ—à—É—Ç–∏—Ç—å –≤ –Ω–∞—á–∞–ª–µ...' },
                    { type: 'sys_bad', body: '‚õî –ü–†–û–í–ê–õ: –í—ã –¥–∞–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–≤–æ–±–æ–¥—ã –Ω–æ–≤–∏—á–∫—É. –ö–ª–∏–µ–Ω—Ç –ø–æ—Ç–µ—Ä—è–Ω.' }
                ],
                options: [
                    { title: '–£—Ç–µ—à–∏—Ç—å', desc: '¬´–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π, –±—ã–≤–∞–µ—Ç¬ª.', next: 'fail_comfort' },
                    { title: '–†–∞–∑–±–æ—Ä –ø–æ–ª–µ—Ç–æ–≤', desc: '¬´–í—ã—Ç–∏—Ä–∞–π —Å–ª–µ–∑—ã. –°–∞–¥–∏—Å—å, —Ä–∞–∑–±–µ—Ä–µ–º –æ—à–∏–±–∫—É –∏ –Ω–∞–ø–∏—à–µ–º —Å–∫—Ä–∏–ø—Ç¬ª.', next: 'win_loop' }
                ]
            },
            'fail_comfort': {
                emails: [{ type: 'sys_bad', body: '‚ùå –ò–¢–û–ì: –ö–∞—Ç—è —É—Å–ø–æ–∫–æ–∏–ª–∞—Å—å, –Ω–æ –Ω–∏—á–µ–º—É –Ω–µ –Ω–∞—É—á–∏–ª–∞—Å—å. –û–Ω–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å–æ–≤–µ—Ä—à–∞—Ç—å –æ—à–∏–±–∫–∏.' }],
                end: true
            },
            'demotivation': {
                my_reply: '–ö–∞—Ç—è, —Å—Ç–æ–ø. –†–∞–Ω–æ —Ç–µ–±–µ –µ—â–µ VIP-–æ–≤ —Ç—Ä–æ–≥–∞—Ç—å. –ò–∑—É—á–∏ —Å–Ω–∞—á–∞–ª–∞ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç.',
                emails: [{ from: 'katya', body: '–ü–æ–Ω—è–ª–∞... –ò–∑–≤–∏–Ω–∏—Ç–µ. (–ë–æ–ª—å—à–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã –Ω–µ –ø—Ä–æ—è–≤–ª—è–µ—Ç).' }, { type: 'sys_bad', body: '‚ö†Ô∏è –ò–¢–û–ì: –í—ã –ø–æ–≥–∞—Å–∏–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—Å—è –≤ –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è.' }],
                end: true
            },
            'win': {
                my_reply: '–ö–∞—Ç—è, —ç–Ω–µ—Ä–≥–∏—è ‚Äî –æ–≥–æ–Ω—å! –ù–æ –∫–ª–∏–µ–Ω—Ç –æ—á–µ–Ω—å –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π. –î–∞–≤–∞–π –Ω–∞–ø—Ä–∞–≤–∏–º —Ç–≤–æ–π –∫—Ä–µ–∞—Ç–∏–≤ –≤ —Ä—É—Å–ª–æ. –ü—Ä—è–º–æ —Å–µ–π—á–∞—Å –ø–∏—à–µ–º —Å–∫—Ä–∏–ø—Ç –∑–≤–æ–Ω–∫–∞, —Ç—ã –º–Ω–µ –µ–≥–æ —Å–¥–∞–µ—à—å, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –∑–≤–æ–Ω–∏—à—å.',
                emails: [{ from: 'katya', body: '–ù—É... –ª–∞–¥–Ω–æ, –¥–∞–≤–∞–π—Ç–µ –ø–∏—Å–∞—Ç—å. –Ø –ø—Ä–æ—Å—Ç–æ –±–æ—è–ª–∞—Å—å —É–ø—É—Å—Ç–∏—Ç—å –º–æ–º–µ–Ω—Ç.' }, { type: 'sys_good', body: '‚úÖ –£–°–ü–ï–•! –í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —ç–Ω–µ—Ä–≥–∏—é –Ω–æ–≤–∏—á–∫–∞, –Ω–æ –¥–∞–ª–∏ –µ–π —á–µ—Ç–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º (–î–∏—Ä–µ–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å).' }],
                success: true,
                end: true
            },
            'win_loop': {
                my_reply: '–≠—Ç–æ –æ–ø—ã—Ç. –°–µ–π—á–∞—Å –º—ã –ø—Ä–æ–ø–∏—à–µ–º –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ, —á—Ç–æ–±—ã –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ —Ç—ã –∑–Ω–∞–ª–∞, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç—å. –û—Ç–∫—Ä—ã–≤–∞–π –¥–æ–∫—É–º–µ–Ω—Ç.',
                emails: [{ from: 'katya', body: '–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –Ω–µ —É–±–∏–ª–∏... –Ø –≥–æ—Ç–æ–≤–∞ —É—á–∏—Ç—å—Å—è.' }, { type: 'sys_good', body: '‚úÖ –°–ü–ê–°–ï–ù–ò–ï: –í—ã –ø–µ—Ä–µ—à–ª–∏ –≤ —Ä–µ–∂–∏–º –Ω–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–∞ –∏ –∏—Å–ø—Ä–∞–≤–∏–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—é.' }],
                success: true,
                end: true
            }
        }
    };

    // --- –î–í–ò–ñ–û–ö ---
    let activeChar = null;
    const threadContent = document.getElementById('thread-content');
    const actionArea = document.getElementById('action-area');
    const startScreen = document.getElementById('start-screen');
    const typing = document.getElementById('typing-indicator');

    function startGame() {
        startScreen.style.display = 'none';
    }

    function showInbox() {
        // –î–ª—è –º–æ–±–∏–ª–æ–∫ - –≤–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É
        document.querySelector('.inbox-list').classList.remove('hidden');
        document.querySelector('.reading-pane').classList.remove('active');
    }

    function openMail(charId) {
        activeChar = charId;
        
        // UI
        document.getElementById('empty-state').style.display = 'none';
        document.querySelector('.thread-view').classList.add('show');
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ
        document.querySelectorAll('.email-item').forEach(el => el.classList.remove('active'));
        document.getElementById('item-' + charId).classList.add('active');
        document.getElementById('item-' + charId).classList.remove('unread');

        // –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è
        if (window.innerWidth <= 700) {
            document.querySelector('.inbox-list').classList.add('hidden');
            document.querySelector('.reading-pane').classList.add('active');
        }

        // –†–µ–Ω–¥–µ—Ä–∏–º –∏—Å—Ç–æ—Ä–∏—é
        renderHistory(charId);

        // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –∑–∞—Ö–æ–¥ - –∑–∞–ø—É—Å–∫–∞–µ–º —Å—Ç–∞—Ä—Ç
        if (state[charId].history.length === 0) {
            processStep(charId, 'start');
        }
    }

    function renderHistory(charId) {
        threadContent.innerHTML = '';
        actionArea.innerHTML = '';
        
        state[charId].history.forEach(block => {
            threadContent.appendChild(block);
        });

        // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏, —Ä–µ–Ω–¥–µ—Ä–∏–º –∏—Ö
        if (state[charId].currentOptions) {
            renderOptions(state[charId].currentOptions);
        }
        
        scrollToBottom();
    }

    function processStep(charId, stepId) {
        const stepData = scenarios[charId][stepId];
        
        // 1. –ï—Å–ª–∏ –µ—Å—Ç—å –ú–û–ô –æ—Ç–≤–µ—Ç (–≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–Ω–µ–µ)
        if (stepData.my_reply) {
            addToHistory(charId, createMailNode('me', stepData.my_reply));
        }

        // 2. –í—Ö–æ–¥—è—â–∏–µ –ø–∏—Å—å–º–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
        let delay = 0;
        if (stepData.emails) {
            stepData.emails.forEach(email => {
                const wait = email.delay || 1000;
                
                // –ï—Å–ª–∏ –ø–∏—à–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–ø–µ—á–∞—Ç–∞–µ—Ç"
                if (!email.type) {
                    setTimeout(() => { 
                        if(activeChar === charId) {
                            typing.style.display = 'block'; 
                            scrollToBottom(); 
                        }
                    }, delay);
                }

                delay += wait;

                setTimeout(() => {
                    typing.style.display = 'none';
                    if (email.type) {
                        addToHistory(charId, createSysMsg(email.body, email.type));
                    } else {
                        addToHistory(charId, createMailNode(email.from, email.body));
                    }
                }, delay);
            });
        }

        // 3. –ö–Ω–æ–ø–∫–∏ (–≤ –∫–æ–Ω—Ü–µ)
        setTimeout(() => {
            if (stepData.options) {
                state[charId].currentOptions = stepData.options;
                if (activeChar === charId) renderOptions(stepData.options);
            }
            
            // –ï—Å–ª–∏ –∫–æ–Ω–µ—Ü
            if (stepData.end) {
                if (stepData.success && state[charId].status !== 'done') {
                    state[charId].status = 'done';
                    state.unread--;
                    updateCounter();
                    document.getElementById('item-' + charId).classList.add('done');
                }
                
                // –ö–Ω–æ–ø–∫–∞ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
                const restartOpt = [{ title: '–ù–∞—á–∞—Ç—å —ç—Ç–æ—Ç –∫–µ–π—Å –∑–∞–Ω–æ–≤–æ', next: 'start', restart: true }];
                state[charId].currentOptions = restartOpt;
                if (activeChar === charId) renderOptions(restartOpt);
            }
        }, delay + 500);
    }

    function addToHistory(charId, node) {
        state[charId].history.push(node);
        if (activeChar === charId) {
            threadContent.appendChild(node);
            scrollToBottom();
        }
    }

    function renderOptions(options) {
        const wrapper = document.createElement('div');
        wrapper.className = 'action-panel';
        wrapper.innerHTML = '<div class="action-title">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</div>';
        
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            
            if (opt.restart) {
                btn.innerHTML = `<strong>üîÑ ${opt.title}</strong>`;
                btn.style.textAlign = 'center';
                btn.onclick = () => restartCase(activeChar);
            } else {
                btn.innerHTML = `<strong>${opt.title}</strong>${opt.desc}`;
                btn.onclick = () => {
                    // –£–±–∏—Ä–∞–µ–º –∫–Ω–æ–ø–∫–∏
                    state[activeChar].currentOptions = null;
                    actionArea.innerHTML = '';
                    // –ò–¥–µ–º –¥–∞–ª—å—à–µ
                    processStep(activeChar, opt.next);
                };
            }
            wrapper.appendChild(btn);
        });
        
        actionArea.innerHTML = '';
        actionArea.appendChild(wrapper);
        scrollToBottom();
    }

    function createMailNode(role, text) {
        const div = document.createElement('div');
        div.className = 'mail-card';
        
        let name = '', avatarClass = '', initials = '';
        if (role === 'alex') { name = '–ê–ª–µ–∫—Å–µ–π –°–º–∏—Ä–Ω–æ–≤'; avatarClass = 'av-alex'; initials = '–ê–°'; }
        if (role === 'katya') { name = '–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –ù–æ–≤–∏–∫–æ–≤–∞'; avatarClass = 'av-katya'; initials = '–ï–ù'; }
        if (role === 'me') { name = '–í—ã (–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å)'; avatarClass = 'av-me'; initials = '–Ø'; }

        div.innerHTML = `
            <div class="mail-header">
                <div style="display:flex; align-items:center;">
                    <div class="mail-avatar ${avatarClass}">${initials}</div>
                    <div style="font-weight:bold; color:#333;">${name}</div>
                </div>
                <div style="font-size:12px; color:#999;">–¢–æ–ª—å–∫–æ —á—Ç–æ</div>
            </div>
            <div class="mail-body">${text}</div>
        `;
        return div;
    }

    function createSysMsg(text, type) {
        const div = document.createElement('div');
        div.className = type === 'sys_good' ? 'sys-msg sys-good' : 'sys-msg sys-bad';
        div.innerText = text;
        return div;
    }

    function restartCase(charId) {
        state[charId].history = [];
        state[charId].currentOptions = null;
        state[charId].status = 'new';
        
        // –í–∏–∑—É–∞–ª—å–Ω—ã–π —Å–±—Ä–æ—Å —Å–ø–∏—Å–∫–∞ (–µ—Å–ª–∏ –±—ã–ª –ø—Ä–æ–π–¥–µ–Ω)
        /* document.getElementById('item-' + charId).classList.remove('done'); */ 
        // –ù–µ —É–±–∏—Ä–∞–µ–º –≥–∞–ª–æ—á–∫—É DONE, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª –ø—Ä–æ–≥—Ä–µ—Å—Å, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–µ—Ä–µ–∏–≥—Ä—ã–≤–∞–µ—Ç
        
        renderHistory(charId);
        processStep(charId, 'start');
    }

    function scrollToBottom() {
        setTimeout(() => {
            threadContent.scrollTop = threadContent.scrollHeight;
            document.getElementById('reading-pane').scrollTop = document.getElementById('reading-pane').scrollHeight;
        }, 100);
    }

    function updateCounter() {
        const badge = document.getElementById('unread-counter');
        badge.innerText = state.unread;
        if (state.unread === 0) {
            badge.style.background = '#107c10'; badge.style.color = 'white';
        }
    }

</script>

</body>
</html>